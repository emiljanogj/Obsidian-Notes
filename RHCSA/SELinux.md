The format of SELinux file context is as follows:

![[Pasted image 20230605141054.png]]

Example: An Apache web server is labeled with the `httpd_t` context and it can only access files labelled with the `httpd_sys_content_t` file context. By default all files in `/var/www/html` are labelled with this context.

![[Pasted image 20230605142038.png]]

To change the SELinux mode, we use the following command:

```
setenforce {Enforcing | Permissive}
```

To display the SELinux context of a file we use the following command:

```
ls -Z {filename}
```

Assume we create a new directory as follows:

```
mkdir /virtual
```

This directory will inherit the `default_t` SELinux context from its parent as follows:

```
[root@host ~] ls -Zd /virtual
unconfined_u:object_r:httpd_sys_content_t:s0 /virtual
```

To restore to the original SELinux context, we do the following:

```
[root@host ~]restorecon -v /virtual
[root@host ~]ls -Zd /virtual
unconfined_u:object_r:default_t:s0 /virtual
```

To restore the default context on all the files and subdirectories, we use the following command:

```
restorecon -Rv /var/www
```

To apply changes to the SELinux context, we use the following command:

```
semanage fcontext - {a | d | l}
```

where:
- a - add context
- d - delete context
- l - list context

We can further add the `- C` option to apply all the local customisations to the context.

#### Adjusting SELinux Policy with Booleans

- To list all the available booleans for SELinux policies, we use the following command:
```
getsebool -a
```

- To enable a user to access their home directory via browser, we use the following command:
```
getsebool httpd_enable_homedirs
```

- To list only the files whose SELinux context has changed, we use the following command:
```
semanage boolean -l -C
```

- To make a SELinux context change persistent, we use the following command:
```
setsebool -P httpd_enable_homedirs on
```

- To search for an event of a given type(AVC) in `/var/log/audit/audit.log` we use the following command:
```
ausearch -m AVC -tsÂ recent
```
AVC Audit Events - These are generated by the AVC subsystem as a result of access denials, or where specific events have requested an audit message

### Lab: Allowing access from a given SELinux context to a directory

- First step is to add the context with the following command:
```
semanage fcontext -a -t {context} '/{dir}(/.*)?'
```
- Then we restore the context with the following command
```
restorecon -Rv /{dir}
```
